(()=>{"use strict";var e={804:(e,t,s)=>{var o=s(618),n=s(205),i=s(191),a=s(516),r=s(981);(e.exports=function(e,t){var s,n,d,l,c;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],o(e)?(s=r.call(e,"c"),n=r.call(e,"e"),d=r.call(e,"w")):(s=d=!0,n=!1),c={value:t,configurable:s,enumerable:n,writable:d},l?i(a(l),c):c}).gs=function(e,t,s){var d,l,c,h;return"string"!=typeof e?(c=s,s=t,t=e,e=null):c=arguments[3],o(t)?n(t)?o(s)?n(s)||(c=s,s=void 0):s=void 0:(c=t,t=s=void 0):t=void 0,o(e)?(d=r.call(e,"c"),l=r.call(e,"e")):(d=!0,l=!1),h={get:t,set:s,configurable:d,enumerable:l},c?i(a(c),h):h}},430:e=>{e.exports=function(){}},191:(e,t,s)=>{e.exports=s(560)()?Object.assign:s(346)},560:e=>{e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},346:(e,t,s)=>{var o=s(103),n=s(745),i=Math.max;e.exports=function(e,t){var s,a,r,d=i(arguments.length,2);for(e=Object(n(e)),r=function(o){try{e[o]=t[o]}catch(e){s||(s=e)}},a=1;a<d;++a)o(t=arguments[a]).forEach(r);if(void 0!==s)throw s;return e}},914:(e,t,s)=>{var o=s(430)();e.exports=function(e){return e!==o&&null!==e}},103:(e,t,s)=>{e.exports=s(446)()?Object.keys:s(137)},446:e=>{e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},137:(e,t,s)=>{var o=s(914),n=Object.keys;e.exports=function(e){return n(o(e)?Object(e):e)}},516:(e,t,s)=>{var o=s(914),n=Array.prototype.forEach,i=Object.create;e.exports=function(e){var t=i(null);return n.call(arguments,(function(e){o(e)&&function(e,t){var s;for(s in e)t[s]=e[s]}(Object(e),t)})),t}},290:e=>{e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},745:(e,t,s)=>{var o=s(914);e.exports=function(e){if(!o(e))throw new TypeError("Cannot use null or undefined");return e}},981:(e,t,s)=>{e.exports=s(591)()?String.prototype.contains:s(42)},591:e=>{var t="razdwatrzy";e.exports=function(){return"function"==typeof t.contains&&!0===t.contains("dwa")&&!1===t.contains("foo")}},42:e=>{var t=String.prototype.indexOf;e.exports=function(e){return t.call(this,e,arguments[1])>-1}},370:(e,t,s)=>{var o,n,i,a,r,d,l,c=s(804),h=s(290),u=Function.prototype.apply,m=Function.prototype.call,g=Object.create,b=Object.defineProperty,p=Object.defineProperties,f=Object.prototype.hasOwnProperty,k={configurable:!0,enumerable:!1,writable:!0};n=function(e,t){var s,n;return h(t),n=this,o.call(this,e,s=function(){i.call(n,e,s),u.call(t,this,arguments)}),s.__eeOnceListener__=t,this},r={on:o=function(e,t){var s;return h(t),f.call(this,"__ee__")?s=this.__ee__:(s=k.value=g(null),b(this,"__ee__",k),k.value=null),s[e]?"object"==typeof s[e]?s[e].push(t):s[e]=[s[e],t]:s[e]=t,this},once:n,off:i=function(e,t){var s,o,n,i;if(h(t),!f.call(this,"__ee__"))return this;if(!(s=this.__ee__)[e])return this;if("object"==typeof(o=s[e]))for(i=0;n=o[i];++i)n!==t&&n.__eeOnceListener__!==t||(2===o.length?s[e]=o[i?0:1]:o.splice(i,1));else o!==t&&o.__eeOnceListener__!==t||delete s[e];return this},emit:a=function(e){var t,s,o,n,i;if(f.call(this,"__ee__")&&(n=this.__ee__[e]))if("object"==typeof n){for(s=arguments.length,i=new Array(s-1),t=1;t<s;++t)i[t-1]=arguments[t];for(n=n.slice(),t=0;o=n[t];++t)u.call(o,this,i)}else switch(arguments.length){case 1:m.call(n,this);break;case 2:m.call(n,this,arguments[1]);break;case 3:m.call(n,this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),t=1;t<s;++t)i[t-1]=arguments[t];u.call(n,this,i)}}},d={on:c(o),once:c(n),off:c(i),emit:c(a)},l=p({},d),e.exports=t=function(e){return null==e?g(l):p(Object(e),d)},t.methods=r},372:(e,t,s)=>{var o=s(60);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!o(e)}},940:(e,t,s)=>{var o=s(618),n={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!o(e)&&hasOwnProperty.call(n,typeof e)}},205:(e,t,s)=>{var o=s(372),n=/^\s*class[\s{/}]/,i=Function.prototype.toString;e.exports=function(e){return!!o(e)&&!n.test(i.call(e))}},60:(e,t,s)=>{var o=s(940);e.exports=function(e){if(!o(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},618:e=>{e.exports=function(e){return null!=e}}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,s),i.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=s(370),t=s.n(e);const o="is not an instance of UIElement.";class n{constructor(e){this.dom=document.createElement(e)}add(){for(let e=0;e<arguments.length;e++){const t=arguments[e];if(t instanceof n)this.dom.appendChild(t.dom);else if(Array.isArray(t))for(let e=0;e<t.length;e++){const s=t[e];s instanceof n?this.dom.appendChild(s.dom):console.error("UIElement:",s,o)}else console.error("UIElement:",t,o)}return this}remove(){for(let e=0;e<arguments.length;e++){const t=arguments[e];t instanceof n?this.dom.removeChild(t.dom):Number.isInteger(t)?this.dom.removeChild(this.dom.childNodes[t]):console.error("UIElement:",t,o)}return this}clear(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild);return this}setId(e){return this.dom.id=e,this}getId(){return this.dom.id}setClass(e){return this.dom.className=e,this}addClass(e){return this.dom.classList.add(e),this}removeClass(e){return this.dom.classList.remove(e),this}setStyle(e,t){return this.dom.style[e]=t,this}setTextContent(e){return this.dom.textContent=e,this}getBoundingClientRect(){return this.dom.getBoundingClientRect()}}class i extends n{constructor(e){super("span"),this.setTextContent(e)}}class a extends n{constructor(){super("div")}}class r extends a{constructor(){super(),this.dom.className="row"}}class d extends a{constructor(){super(),this.dom.className="panel"}}class l extends n{constructor(e,t){super("label"),this.dom.textContent=e,t&&(this.dom.htmlFor=t)}}class c extends n{constructor(e,t){super("a"),this.dom.href=e||"#",this.dom.textContent=t||""}setHref(e){return this.dom.href=e,this}}class h extends i{constructor(e){super(),this.dom.textContent=e}getValue(){return this.dom.textContent}setValue(e){return this.dom.textContent=e,this}}class u extends n{constructor(){super("textarea"),this.dom.spellcheck=!1,this.dom.onkeydown=e=>{e.stopPropagation()}}getValue(){return this.dom.value}setValue(e){return this.dom.value=e,this}}class m extends n{constructor(){super("select")}setMultiple(e){return this.dom.multiple=e||!1,this}setOptions(e){const t=this.dom.value;this.clear();for(const t in e){const s=document.createElement("option");s.value=t,s.text=e[t],this.dom.appendChild(s)}return this.dom.value=t,this}getValue(){return this.dom.value}setValue(e){return e=String(e),this.dom.value!==e&&(this.dom.value=e),this}}class g extends n{constructor(e,t,s){super("input"),this.dom.type=e,this.dom.onkeydown=e=>{e.stopPropagation()},this.setValue(t),this.setTitle(s)}getName(){return this.dom.name}setName(e){return this.dom.name=e,this}getTitle(){return this.dom.title}setTitle(e){return this.dom.title!==e&&e&&(this.dom.title=e),this}getType(){return this.dom.type}setType(e){return this.dom.type=e,this}getValue(){return this.dom.value}setValue(e){return this.dom.value!==e&&e&&(this.dom.value=e),this}}class b extends n{constructor(e,t,s,o,n){super("input"),this.dom.type="number",this.dom.step=t||1,this.dom.onkeydown=e=>{e.stopPropagation()},this.value=e||0,this.min=s||-1/0,this.max=o||1/0,this.precision=n||0,this.setValue(e),this.dom.onchange=e=>{this.setValue(this.value)}}getName(){return this.dom.name}setName(e){return this.dom.name=e,this}setPrecision(e){return this.precision=e,this.setValue(this.value),this}setRange(e,t){return this.min=e,this.max=t,this.dom.min=e,this.dom.max=t,this}setStep(e){return this.dom.step=e,this}setTitle(e){return this.dom.title=e,this}getValue(){return parseFloat(this.dom.value)}setValue(e){return void 0!==e&&((e=parseFloat(e))<this.min&&(e=this.min),e>this.max&&(e=this.max),this.value=e,this.dom.value=e.toFixed(this.precision)),this}}class p extends a{constructor(e){super(),this.align=e||"horizontal",this.tabs=[],this.panels=[],this.selector=(new i).setClass("tab-selector"),this.tabsDiv=(new a).setClass("tabs"),this.tabsDiv.add(this.selector),this.panelsDiv=(new a).setClass("panels"),this.selected="",this.add(this.tabsDiv),this.add(this.panelsDiv)}addTab(e,t,s){const o=new f(t,this);o.setId(e),o.setClass("tab"),this.tabs.push(o),this.tabsDiv.add(o);const n=new a;n.setId(e),n.add(s),this.panels.push(n),this.panelsDiv.add(n),this.select(e)}select(e){for(let t of this.tabs)t.dom.id===e?(t.addClass("selected"),this.transformSelector(t)):t.dom.id===this.selected&&t.removeClass("selected");for(let t of this.panels)t.dom.id===e?t.dom.style.display="block":t.dom.id===this.selected&&(t.dom.style.display="none");return this.selected=e,this}transformSelector(e){let t;const s=e.getBoundingClientRect();"horizontal"===this.align?(t=s.width*this.tabs.indexOf(e),this.selector.dom.style.transform=`translateX(${t}px)`):(t=s.height*this.tabs.indexOf(e),this.selector.dom.style.transform=`translateY(${t}px)`)}}class f extends a{constructor(e,t){super();const s=new g("button");s.dom.title=e,this.dom.onclick=e=>{t.select(this.dom.id),e.preventDefault()},this.add(s)}}class k extends n{constructor(e){super("ul"),this.parent=e&&e.parent,this.expanded=!1}expand(){return this.expanded=!0,this.dom.style.display="block",this.parent&&this.parent.expand(),this}collaps(){return this.expanded=!1,this.dom.style.display="none",this}}class w extends n{constructor(e){super("li"),this.parent=e,this.selected=!1}select(){return this.selected=!0,this.setClass("selected"),this}unselect(){return this.selected=!1,this.dom.removeAttribute("class"),this}}class v extends d{constructor(e){super(),super.setId("metadata");const t=(new h).setId("book-title"),s=(new h).setId("book-creator"),o=(new h).setId("book-title-separator");super.add([t,o,s]),e.on("metadata",(e=>{document.title=e.title,document.title=e.creator?" - "+e.creator:"",t.setValue(e.title),e.creator&&(s.setValue(e.creator),o.dom.style.display="inline-block")}))}}class y{constructor(e){const t=e.strings,s=(new a).setId("toolbar"),o=["toolbar/opener","toolbar/openbook","toolbar/openbook/error","toolbar/bookmark","toolbar/fullsceen"],n=(new d).setId("start"),i=new g("button").setId("btn-s");i.dom.title=t.get(o[0]),i.dom.onclick=()=>{const t=i.dom.classList.length>0;e.emit("sidebaropener",!t),t?i.removeClass("open"):i.addClass("open")},n.add(i);const r=t=>{c.clear(),c.set(t.target.result,(()=>{e.unload(),e.init(t.target.result,{restore:!0});const s=new URL(window.location.origin);window.history.pushState({},"",s)}))},l=e=>{console.error(e)},c=window.storage,h=(new d).setId("end"),u=new g("file").setId("btn-o");u.dom.title=t.get(o[1]),u.dom.accept="application/epub+zip",u.dom.onchange=e=>{if(0!==e.target.files.length)if(window.FileReader){const t=new FileReader;t.onload=r,t.readAsArrayBuffer(e.target.files[0]),t.onerror=l}else alert(t.get(o[2]))},h.add(u);const m=new g("button").setId("btn-b");m.dom.title=t.get(o[3]),m.dom.onclick=t=>{const s=this.locationCfi,o=-1===e.isBookmarked(s);e.emit("bookmarked",o)},h.add(m);let b=null;document.fullscreenEnabled&&(b=new g("button").setId("btn-f"),b.dom.title=t.get(o[4]),b.dom.onclick=e=>{this.toggleFullScreen()},document.onkeydown=e=>{"F11"===e.key&&(e.preventDefault(),this.toggleFullScreen())},document.onfullscreenchange=e=>{const t=window.screen.width===e.target.clientWidth,s=window.screen.height===e.target.clientHeight;t&&s?b.addClass("resize-small"):b.removeClass("resize-small")},h.add(b)),s.add([n,new v(e),h]),document.body.appendChild(s.dom),e.on("relocated",(t=>{const s=t.start.cfi;-1===e.isBookmarked(s)?m.removeClass("bookmarked"):m.addClass("bookmarked"),this.locationCfi=s})),e.on("bookmarked",(e=>{e?m.addClass("bookmarked"):m.removeClass("bookmarked")})),e.on("languagechanged",(e=>{i.dom.title=t.get(o[0]),u.dom.title=t.get(o[1]),m.dom.title=t.get(o[3]),b&&(b.dom.title=t.get(o[4]))}))}toggleFullScreen(){document.activeElement.blur(),null===document.fullscreenElement?document.documentElement.requestFullscreen():document.exitFullscreen&&document.exitFullscreen()}}class x extends d{constructor(e){super();const t=(new a).setClass("list-container");this.setId("contents"),this.reader=e,this.selector=void 0,e.on("navigation",(e=>{t.clear(),t.add(this.generateToc(e)),this.add(t)}))}generateToc(e,t){const s=new k(t);return e.forEach((e=>{const t=new c(e.href,e.label),o=new w(s).setId(e.id),n=(new a).setId("expander");if(t.dom.onclick=()=>(this.selector&&this.selector!==o&&this.selector.unselect(),o.select(),this.selector=o,this.reader.settings.sectionId=e.id,this.reader.rendition.display(e.href),!1),o.add([n,t]),this.reader.navItems[e.href]={id:e.id,label:e.label},this.reader.settings.sectionId===e.id&&(s.expand(),o.select(),this.selector=o),e.subitems&&e.subitems.length>0){const t=this.generateToc(e.subitems,o),s=(new i).setClass("toggle-collapsed");s.dom.onclick=()=>(t.expanded?(t.collaps(),s.setClass("toggle-collapsed")):(t.expand(),s.setClass("toggle-expanded")),!1),n.add(s),o.add(t)}s.add(o)})),s}}class C extends d{constructor(e){super();const t=(new a).setClass("list-container"),s=e.strings,o=new r,n=[s.get("sidebar/bookmarks/add"),s.get("sidebar/bookmarks/remove"),s.get("sidebar/bookmarks/clear")],i=new g("button",n[0]).addClass("btn-start"),d=new g("button",n[1]).addClass("btn-medium"),l=new g("button",n[2]).addClass("btn-end");i.dom.onclick=()=>(e.emit("bookmarked",!0),!1),d.dom.onclick=()=>(e.emit("bookmarked",!1),!1),l.dom.onclick=()=>(this.clearBookmarks(),e.emit("bookmarked",!1),!1),o.add([i,d,l]),this.bookmarks=new k,t.add(this.bookmarks),this.setId("bookmarks"),this.add([o,t]),this.reader=e;const c=()=>{d.dom.disabled=0===e.settings.bookmarks.length,l.dom.disabled=0===e.settings.bookmarks.length};e.on("displayed",((e,t)=>{t.bookmarks.forEach((e=>{this.setBookmark(e)})),c()})),e.on("relocated",(t=>{const s=t.start.cfi,o=-1===e.isBookmarked(s);i.dom.disabled=!o,d.dom.disabled=o,this.locationCfi=s})),e.on("bookmarked",(e=>{e?(this.appendBookmark(),i.dom.disabled=!0):(this.removeBookmark(),i.dom.disabled=!1),c()}))}appendBookmark(){const e=this.locationCfi;this.reader.isBookmarked(e)>-1||(this.setBookmark(e),this.reader.settings.bookmarks.push(e))}removeBookmark(){const e=this.locationCfi,t=this.reader.isBookmarked(e);-1!==t&&(this.bookmarks.remove(t),this.reader.settings.bookmarks.splice(t,1))}clearBookmarks(){this.bookmarks.clear(),this.reader.settings.bookmarks=[]}setBookmark(e){const t=new c,s=new w,o=this.reader.navItemFromCfi(e);let n,i;if(void 0===o){const t=this.reader.book.spine.get(e);n=t.idref,i=t.idref}else n=o.id,i=o.label;t.setHref("#"+e),t.dom.onclick=()=>(this.reader.rendition.display(e),!1),t.setTextContent(i),s.add(t),s.setId(n),this.bookmarks.add(s)}}class I extends d{constructor(e){super();const t=(new a).setClass("list-container"),s=e.strings,o=new r,n=new r,i=[s.get("sidebar/annotations/add"),s.get("sidebar/annotations/clear")],d=new u;d.dom.oninput=e=>{this.update()};const l=new g("button",i[0]).addClass("btn-start");l.dom.disabled=!0,l.dom.onclick=()=>{const t={cfi:this.cfiRange,date:new Date,text:d.getValue(),uuid:e.uuid()};return e.settings.annotations.push(t),d.setValue(""),this.set(t),!1};const c=new g("button",i[1]).addClass("btn-end");c.dom.disabled=!0,c.dom.onclick=()=>(this.clearNotes(),!1),o.add(d),n.add([l,c]),this.notes=new k,t.add(this.notes),this.setId("annotations"),this.add([o,n,t]),this.reader=e,this.update=()=>{l.dom.disabled=!this.range||0===d.getValue().length,c.dom.disabled=0===e.settings.annotations.length},e.on("bookready",(e=>{e.annotations.forEach((e=>{this.set(e)}))})),e.on("selected",((e,t)=>{this.cfiRange=e,this.range=t.range(e),this.update()})),e.on("unselected",(()=>{this.range=void 0,this.update()}))}set(e){const t=new c("#"+e.cfi,e.text),s=(new w).setId("note-"+e.uuid),o=(new i).setClass("btn-remove");t.onclick=()=>(this.reader.rendition.display(e.cfi),!1),o.dom.onclick=()=>(this.removeNote(e),!1),s.add([t,o]),this.notes.add(s),this.reader.rendition.annotations.add("highlight",e.cfi,{},(()=>{}),"note-highlight",{}),this.update()}removeNote(e){const t=this.reader.settings.annotations.indexOf(e);-1!==t&&(this.notes.remove(t),this.reader.settings.annotations.splice(t,1),this.reader.rendition.annotations.remove(e.cfi,"highlight"),this.update())}clearNotes(){this.reader.settings.annotations.forEach((e=>{this.reader.rendition.annotations.remove(e.cfi,"highlight")})),this.notes.clear(),this.reader.settings.annotations=[],this.update()}}class S extends d{constructor(e){super();const t=(new a).setClass("list-container"),s=e.strings;let o;const n=new g("search");n.dom.placeholder=s.get("sidebar/search/placeholder"),n.dom.onsearch=()=>{const e=n.getValue();0===e.length?this.items.clear():o!==e&&(this.items.clear(),this.doSearch(e).then((e=>{e.forEach((e=>{this.set(e)}))}))),o=e};const i=new r;i.add(n),this.setId("search"),this.items=new k,t.add(this.items),this.add([i,t]),this.reader=e}async doSearch(e){const t=this.reader.book,s=await Promise.all(t.spine.spineItems.map((s=>s.load(t.load.bind(t)).then(s.find.bind(s,e)).finally(s.unload.bind(s)))));return await Promise.resolve([].concat.apply([],s))}set(e){const t=new c("#"+e.cfi,e.excerpt),s=new w;t.dom.onclick=()=>(this.reader.rendition.display(e.cfi),!1),s.add(t),this.items.add(s)}}class _ extends d{constructor(e){super(),super.setId("settings");const t=e.strings,s=["sidebar/settings/language","sidebar/settings/fontsize","sidebar/settings/layout","sidebar/settings/spread","sidebar/settings/spread/pagewidth"],o=new l(t.get(s[0]),"language-ui"),n=new r,i=(new m).setOptions({en:"English",fr:"French",ja:"Japanese",ru:"Russian"});i.dom.onchange=t=>{e.emit("languagechanged",t.target.value)},i.setId("language-ui"),n.add(o),n.add(i);const a=new l(t.get(s[1]),"fontsize"),d=new r,c=new b(100,1);c.dom.onchange=t=>{e.emit("styleschanged",{fontSize:parseInt(t.target.value)})},c.setId("fontsize"),d.add(a),d.add(c);const h=new l(t.get(s[2]),"layout"),u=new r,p=(new m).setOptions({paginated:"Paginated",scrolled:"Scrolled"});p.dom.onchange=t=>{e.emit("flowchanged",t.target.value),"scrolled"===t.target.value?e.emit("spreadchanged",{mod:"none",min:void 0}):e.emit("spreadchanged",{mod:void 0,min:void 0})},p.setId("layout"),u.add(h),u.add(p);const f=new l(t.get(s[3]),"spread"),k=new r,w=(new m).setOptions({none:"None",auto:"Auto"});w.dom.onchange=t=>{e.emit("spreadchanged",{mod:t.target.value,min:void 0})},w.setId("spread"),k.add(f),k.add(w);const v=new l(t.get(s[4]),"min-spread-width"),y=new r,x=new b(800,1);x.dom.onchange=t=>{e.emit("spreadchanged",{mod:void 0,min:parseInt(t.target.value)})},x.setId("min-spread-width"),y.add(v),y.add(x);const C=t.get("sidebar/settings/pagination"),I=new r,S=new g("checkbox",!1,C[1]);S.setId("pagination"),S.dom.onclick=e=>{},I.add(new l(C[0],"pagination")),I.add(S),super.add([n,d,u,k,y]),e.on("bookready",(e=>{i.setValue(e.language),c.setValue(e.styles.fontSize),p.setValue(e.flow),w.setValue(e.spread.mod),x.setValue(e.spread.min)})),e.on("layout",(e=>{"scrolled"===e.flow?(w.dom.disabled=!0,w.setValue("none")):w.dom.disabled=!1})),e.on("languagechanged",(e=>{o.dom.textContent=t.get(s[0]),a.dom.textContent=t.get(s[1]),h.dom.textContent=t.get(s[2]),f.dom.textContent=t.get(s[3]),v.dom.textContent=t.get(s[4])}))}}class O{constructor(e){const t=e.strings,s=[t.get("sidebar/contents"),t.get("sidebar/bookmarks"),t.get("sidebar/annotations"),t.get("sidebar/search"),t.get("sidebar/settings")],o=new p("vertical").setId("sidebar");o.addTab("tab-t",s[0],new x(e)),o.addTab("tab-b",s[1],new C(e)),o.addTab("tab-n",s[2],new I(e)),o.addTab("tab-s",s[3],new S(e)),o.addTab("tab-c",s[4],new _(e)),o.select("tab-t"),document.body.appendChild(o.dom)}}class z{constructor(e){const t=(new a).setId("content");t.dom.ontransitionend=t=>{e.emit("sidebarreflow"),t.preventDefault()};const s=(new a).setId("prev").setClass("arrow");s.dom.onclick=t=>{e.emit("prev"),t.preventDefault()},s.add(new i("<"));const o=(new a).setId("next").setClass("arrow");o.dom.onclick=t=>{e.emit("next"),t.preventDefault()},o.add(new i(">"));const n=(new a).setId("viewer"),r=(new a).setId("divider"),d=(new a).setId("loader");t.add([s,n,o,r,d]),document.body.appendChild(t.dom),e.on("bookready",(e=>{d.dom.style.display="block"})),e.on("bookloaded",(()=>{d.dom.style.display="none"})),e.on("sidebaropener",(e=>{e?t.addClass("closed"):t.removeClass("closed")})),e.on("layout",(e=>{e.spread&&e.width>e.spreadWidth?r.dom.style.display="block":r.dom.style.display="none"})),e.on("relocated",(e=>{e.atStart?s.addClass("disabled"):s.removeClass("disabled"),e.atEnd?o.addClass("disabled"):o.removeClass("disabled")})),e.on("prev",(()=>{s.addClass("active"),setTimeout((()=>{s.removeClass("active")}),100)})),e.on("next",(()=>{o.addClass("active"),setTimeout((()=>{o.removeClass("active")}),100)})),e.on("viewercleanup",(()=>{n.clear()}))}}class B{constructor(e){this.language=e.settings.language||"en",this.values={en:{"toolbar/opener":"Sidebar","toolbar/openbook":"Open book","toolbar/openbook/error":"Your browser does not support the required features.\nPlease use a modern browser such as Google Chrome, or Mozilla Firefox.","toolbar/bookmark":"Add this page to bookmarks","toolbar/fullsceen":"Fullscreen","sidebar/contents":"Contents","sidebar/bookmarks":"Bookmarks","sidebar/bookmarks/add":"Add","sidebar/bookmarks/remove":"Remove","sidebar/bookmarks/clear":"Clear","sidebar/annotations":"Annotations","sidebar/annotations/add":"Add","sidebar/annotations/clear":"Clear","sidebar/annotations/anchor":"Anchor","sidebar/annotations/cancel":"Cancel","sidebar/search":"Search","sidebar/search/placeholder":"Search","sidebar/settings":"Settings","sidebar/settings/language":"Language","sidebar/settings/fontsize":"Font size (%)","sidebar/settings/layout":"Layout","sidebar/settings/pagination":["Pagination","Generate pagination"],"sidebar/settings/spread":"Spread","sidebar/settings/spread/pagewidth":"Page width"},fr:{"toolbar/opener":"Barre latérale","toolbar/openbook":"Ouvrir un livre local","toolbar/openbook/error":"Votre navigateur ne prend pas en charge les fonctions nécessaires.\nVeuillez utiliser un navigateur moderne tel que Google Chrome ou Mozilla Firefox.","toolbar/bookmark":"Insérer un marque page ici","toolbar/fullsceen":"Plein écran","sidebar/contents":"Sommaire","sidebar/bookmarks":"Marque-pages","sidebar/bookmarks/add":"Ajouter","sidebar/bookmarks/remove":"Retirer","sidebar/bookmarks/clear":"Tout enlever","sidebar/annotations":"Annotations","sidebar/annotations/add":"Ajouter","sidebar/annotations/clear":"Tout enlever","sidebar/annotations/anchor":"Ancre","sidebar/annotations/cancel":"Annuler","sidebar/search":"Rechercher","sidebar/search/placeholder":"rechercher","sidebar/settings":"Réglages","sidebar/settings/language":"Langue","sidebar/settings/fontsize":"???","sidebar/settings/layout":"???","sidebar/settings/pagination":["Pagination","Établir une pagination"],"sidebar/settings/spread":"???","sidebar/settings/spread/pagewidth":"???"},ja:{"toolbar/opener":"サイドバー","toolbar/openbook":"本を開く","toolbar/openbook/error":"ご利用のブラウザは必要な機能をサポートしていません。\nGoogle Chrome、Mozilla Firefox、その他のモダンなブラウザでご利用ください。","toolbar/bookmark":"このページに栞を設定する","toolbar/fullsceen":"フルスクリーン","sidebar/contents":"目次","sidebar/bookmarks":"栞","sidebar/bookmarks/add":"追加","sidebar/bookmarks/remove":"削除","sidebar/bookmarks/clear":"クリア","sidebar/annotations":"注釈","sidebar/annotations/add":"追加","sidebar/annotations/clear":"クリア","sidebar/annotations/anchor":"アンカー","sidebar/annotations/cancel":"キャンセル","sidebar/search":"検索","sidebar/search/placeholder":"検索","sidebar/settings":"設定","sidebar/settings/language":"表示言語","sidebar/settings/fontsize":"???","sidebar/settings/layout":"???","sidebar/settings/pagination":["ページネーション","ページネーションを生成します。"],"sidebar/settings/spread":"???","sidebar/settings/spread/pagewidth":"???"},ru:{"toolbar/opener":"Боковая панель","toolbar/openbook":"Открыть книгу","toolbar/openbook/error":"Ваш браузер не поддерживает необходимые функции.\nПожалуйста, используйте современный браузер, такой как Google Chrome или Mozilla Firefox.","toolbar/bookmark":"Добавить эту страницу в закладки","toolbar/fullsceen":"Полноэкранный режим","sidebar/contents":"Содержание","sidebar/bookmarks":"Закладки","sidebar/bookmarks/add":"Добавить","sidebar/bookmarks/remove":"Удалить","sidebar/bookmarks/clear":"Очистить","sidebar/annotations":"Аннотации","sidebar/annotations/add":"Добавить","sidebar/annotations/clear":"Очистить","sidebar/annotations/anchor":"Метка","sidebar/annotations/cancel":"Отмена","sidebar/search":"Поиск","sidebar/search/placeholder":"Поиск","sidebar/settings":"Настройки","sidebar/settings/language":"Язык","sidebar/settings/fontsize":"Размер шрифта","sidebar/settings/layout":"Макет","sidebar/settings/pagination":["Нумерация страниц","Генерировать нумерацию страниц"],"sidebar/settings/spread":"Разворот","sidebar/settings/spread/pagewidth":"Ширина страницы"}},e.on("languagechanged",(e=>{this.language=e}))}get(e){return this.values[this.language][e]||"???"}}class D{constructor(e,t){this.settings=void 0,this.cfgInit(e,t),this.strings=new B(this),this.toolbar=new y(this),this.sidebar=new O(this),this.content=new z(this),this.book=void 0,this.rendition=void 0,this.displayed=void 0,this.init(),window.onbeforeunload=this.unload.bind(this),window.onhashchange=this.hashChanged.bind(this),window.onkeydown=this.keyboardHandler.bind(this),window.onwheel=e=>{e.ctrlKey&&e.preventDefault()}}init(e,t){this.emit("viewercleanup"),this.navItems={},arguments.length>0&&this.cfgInit(e,t),this.book=ePub(this.settings.bookPath),this.rendition=this.book.renderTo("viewer",{flow:this.settings.flow,spread:this.settings.spread.mod,minSpreadWidth:this.settings.spread.min,width:"100%",height:"100%"});const s=this.settings.previousLocationCfi;this.displayed=s?this.rendition.display(s):this.rendition.display(),this.displayed.then((e=>{this.emit("displayed",e,this.settings)})),this.book.ready.then((()=>{this.emit("bookready",this.settings)})).then((()=>{this.emit("bookloaded")})),this.book.loaded.metadata.then((e=>{this.emit("metadata",e)})),this.book.loaded.navigation.then((e=>{this.emit("navigation",e)})),this.rendition.on("click",(e=>{"Range"!==e.view.document.getSelection().type&&this.emit("unselected")})),this.rendition.on("layout",(e=>{this.emit("layout",e)})),this.rendition.on("selected",((e,t)=>{this.setLocation(e),this.emit("selected",e,t)})),this.rendition.on("relocated",(e=>{this.setLocation(e.start.cfi),this.emit("relocated",e)})),this.on("prev",(()=>{"rtl"===this.book.package.metadata.direction?this.rendition.next():this.rendition.prev()})),this.on("next",(()=>{"rtl"===this.book.package.metadata.direction?this.rendition.prev():this.rendition.next()})),this.on("sidebarreflow",(()=>{})),this.on("languagechanged",(e=>{this.settings.language=e})),this.on("flowchanged",(e=>{this.settings.flow=e,this.rendition.flow(e)})),this.on("spreadchanged",(e=>{const t=e.mod||this.settings.spread.mod,s=e.min||this.settings.spread.min;this.settings.spread.mod=t,this.settings.spread.min=s,this.rendition.spread(t,s)})),this.on("styleschanged",(e=>{const t=e.fontSize;this.settings.styles.fontSize=t,this.rendition.themes.fontSize(t+"%")}))}defaults(e){for(let t=1,s=arguments.length;t<s;t++){const s=arguments[t];for(let t in s)void 0===e[t]&&(e[t]=s[t])}return e}uuid(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{let s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:7&s|8).toString(16)}))}navItemFromCfi(e){const t=this.rendition.getRange(e).startContainer.parentNode.id,s=this.rendition.currentLocation().start.href;return this.navItems[s+"#"+t]||this.navItems[s]}isBookmarked(e){return this.settings.bookmarks.indexOf(e)}isAnnotated(e){return this.settings.annotations.indexOf(e)}cfgInit(e,t){this.entryKey=md5(e).toString(),this.settings=this.defaults(t||{},{bookPath:e,flow:void 0,restore:!1,history:!0,reload:!1,bookmarks:void 0,annotations:void 0,contained:void 0,sectionId:void 0,spread:void 0,styles:void 0,pagination:!1,language:void 0}),this.settings.restore&&this.isSaved()&&this.applySavedSettings(),void 0===this.settings.bookmarks&&(this.settings.bookmarks=[]),void 0===this.settings.annotations&&(this.settings.annotations=[]),void 0===this.settings.flow&&(this.settings.flow="paginated"),void 0===this.settings.spread&&(this.settings.spread={mod:"auto",min:800}),void 0===this.settings.styles&&(this.settings.styles={fontSize:100}),void 0===this.settings.language&&(this.settings.language="en")}isSaved(){return!!localStorage&&null!==localStorage.getItem(this.entryKey)}removeSavedSettings(){return!!this.isSaved()&&(localStorage.removeItem(this.entryKey),!0)}applySavedSettings(){if(!localStorage)return!1;let e;try{e=JSON.parse(localStorage.getItem(this.entryKey))}catch(e){console.exception(e)}return!!e&&(e.spread&&(this.settings.spread=this.defaults(this.settings.spread||{},e.spread)),e.styles&&(this.settings.styles=this.defaults(this.settings.styles||{},e.styles)),this.settings=this.defaults(this.settings,e),!0)}saveSettings(){this.settings.previousLocationCfi=this.rendition.location.start.cfi,localStorage.setItem(this.entryKey,JSON.stringify(this.settings))}setLocation(e){const t=this.book.archived?void 0:this.book.url,s=new URL(window.location,t);s.hash="#"+e,this.settings.history&&window.location.hash!==s.hash&&(window.history.pushState({},"",s),this.currentLocationCfi=e)}unload(){this.settings.restore&&localStorage&&this.saveSettings()}hashChanged(){const e=window.location.hash.slice(1);this.rendition.display(e)}keyboardHandler(e){if(e.ctrlKey||e.metaKey){const t=2;let s=this.settings.styles.fontSize;switch(e.key){case"=":e.preventDefault(),s+=t,this.emit("styleschanged",{fontSize:s});break;case"-":e.preventDefault(),s-=t,this.emit("styleschanged",{fontSize:s});break;case"0":e.preventDefault(),s=100,this.emit("styleschanged",{fontSize:s})}}else switch(e.key){case"ArrowLeft":this.emit("prev"),e.preventDefault();break;case"ArrowRight":this.emit("next"),e.preventDefault()}}}t()(D.prototype);class j{constructor(){this.name="epubjs-reader",this.version=1,this.database,this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,void 0===this.indexedDB&&alert("The IndexedDB API not available in your browser.")}init(e){if(void 0===this.indexedDB)return void e();const t=this,s=indexedDB.open(this.name,this.version);s.onupgradeneeded=function(e){const t=e.target.result;!1===t.objectStoreNames.contains("entries")&&t.createObjectStore("entries")},s.onsuccess=function(s){t.database=s.target.result,t.database.onerror=function(e){console.error("IndexedDB",e)},e()},s.onerror=function(e){console.error("IndexedDB",e)}}get(e){void 0!==this.database?this.database.transaction(["entries"],"readwrite").objectStore("entries").get(0).onsuccess=function(t){e(t.target.result),console.log("storage.get")}:e()}set(e,t){void 0!==this.database?this.database.transaction(["entries"],"readwrite").objectStore("entries").put(e,0).onsuccess=function(){t(),console.log("storage.set")}:t()}clear(){void 0!==this.database&&(this.database.transaction(["entries"],"readwrite").objectStore("entries").clear().onsuccess=function(){console.log("storage.clear")})}}window.ResizeObserver=void 0,window.onload=function(){const e=new j,t=new URL(window.location),s=void 0!==window.bookPath?window.bookPath:t.search.length>0?t.searchParams.get("bookPath"):"https://s3.amazonaws.com/moby-dick/";e.init((function(){e.get((function(e){void 0!==e&&0===t.search.length?window.reader=new D(e,{restore:!0}):window.reader=new D(s,{restore:!0})}))})),window.storage=e}})()})();
//# sourceMappingURL=epubreader.js.map